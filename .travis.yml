language: java
jdk: oraclejdk8

branches:
  except:
    - code-analysis

env:
  global:
    - MAVEN_OPTS="-Xms1024m -Xmx4g -Dmaven.repo.local=$HOME/.m2/repository -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true"
    - MAVEN_CLI_OPTS="--batch-mode --errors --fail-at-end --show-version"
    - # DOCKER_USERNAME
    - secure: "K23OtDvjFOuxGedcv7Y3kiu2XtpGDwLO0FWN0eieFzjlMHZU1k/whRMD41FhN89ocjKMI5pEQFIzPlETzq+ZxZa/YtQL7spcif4Q3ppe9RXfG6uUdgfFHpP5IUnpnDN8jqX3yRc+W371H3726s3s+LzoP/ANILd/WQP9rzXd8Ts="
    # DOCKER_PASSWORD
    - secure: "gDM83kopiEhqJfP9bEMSFmqAnbfLU+HInDpvZ8LQBZ2kA/0CjXCmcm4St/R70FJxd2iFo6YRUl6olPCpmuk4XJ9YSaRBtKcP2QV0tcxjLmtGlS3N6fsuLWn87Q/GUAdE30sp71fo47FAmdcfL68UzK0UgQcqZIKeZZ288ScrbIc="

    - SONARPLUGIN="sonar:sonar"

before_install:
  - sed -r "s/ARTIFACTORY_USER/$ARTIFACTORY_USER/g;s/ARTIFACTORY_PASS/$ARTIFACTORY_PASS/g" .travis/maven_settings.xml > $HOME/.m2/settings.xml

script:
  # the following command line builds the project, runs the tests with coverage and then execute the SonarQube analysis
  - travis_wait 30 mvn $MAVEN_CLI_OPTS -Dtestng.groups="travis-ci" -Dlogback.configurationFile=logback-travis.xml -Dsonar.scm.disabled=true clean org.jacoco:jacoco-maven-plugin:prepare-agent install $SONARPLUGIN

deploy:
  provider: script
  script: .travis/deploy.sh
  all_branches: true

after_script:
  - rm $HOME/.m2/settings.xml

cache:
  directories:
    - $HOME/.m2/repository
    - $HOME/.sonar/cache

notifications:
  slack:
    secure: M7jJ1dmO1cx//vgzY5UgE650Fe/lm21Dm8WLDXJfz66hmjQihoYCzW19Id/ySgPs/exjEvS1Lvxa4r4t5mgQOe+uPpQOZKEK3IfQ6h7zIv40Rbsa6mY9GaAW4x1Obji5a7HNGD7BQiolYDX1jmtBxOcSetesvL5iX1Bru0E/R78=
